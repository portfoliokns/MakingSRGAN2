# このアプリケーションについて

このアプリケーションは敵対的生成ネットワーク（GAN）を用いて、超解像 AI （SRGAN）を作成するための python プログラムになります。このリポジトリで提供されている機能は次のとおりです。なおこのプログラムソースを作った者は AI エンジニアではなく、ChatGPT によって全面的にサポート・支援されて作ったものになります。作成者が意図しない不具合・誤りが含まれている可能性が通常のプログラム開発と比べて高いです。

- 超解像 AI 作成機能（train.py）
  - 生成器（G）と識別器（D）を競い合わせて、「高解像度の画像（正解の画像）」と「生成器（G）によって低解像度の画像から生成されたフェイク画像」をもとに識別器（D）でそれがフェイクであるか本物であるかを識別&学習させつつ、生成器（G）を学習させていくソースプログラム。最終的には.pth ファイルが出力されます。
- 画像生成機能（upscale.py）
  - 超解像 AI 作成機能で作成した.pth ファイル、俗にいう学習済みモデルに対し、高画質化したい画像をインプットすることで、画像を高画質化&2 倍のサイズにすることができるソースプログラム。
- 低画像作成&移動機能（downscale.py）
  - 学習に用いたい画像を意図的に半分のサイズにする（低画像化する）ことができるソースプログラム。
- モデルクラス（model.py）
  - 生成器（G）と識別器（D）を定義しているソースプログラム。
  - [こちら](https://arxiv.org/abs/1609.04802)の論文のモデルを採用しています。※低スペック GPU で実行ができるように、Discriminator のパラメータを一部小さくしています。
- データセットクラス（model.py）
  - 学習に用いる画像データの取得や画像データの回転等を定義しているソースプログラム。

※必要に応じて、アップデートする可能性があります。

# 各種機能について

## 超解像 AI 作成機能(train.py)

### ハイパーパラメータ

ハイパーパラメータとは、機械学習を実施していく上で学習条件を設定するパラメータ群です。実行する際は、これらのパラメータを調整しながら、実行していく必要があります。

- epochs・・・学習する回数を指定するパラメータ 🚨 少しずつパラメータを上げて実行してください。
- batch_size・・・1 つのバッチに対して何枚の画像を適応するかを設定するパラメータ 🚨 これは GPU のメモリに依存するので、out of memory にならないように設定が必要です。
- lr_g・・・生成器（G）の学習率
- lr_d・・・識別器（D）の学習率
- λ・・・知覚的損失、敵対的損失、L1 損失のパラメータ

### チェックポイント

このソースコードでは途中で学習を中断しても、再開できるようにチェックポイント機能を設けています。ただしエポックが終了したタイミングでしか、保存できないようになっているので、万が一停止したい場合は、1 エポックが終了したタイミングで停止することをお勧めする。（エポックが終了したタイミングでしか保存されない）

### 学習ループ

生成器（G）と識別器（D）を競い合わせて、それぞれを学習させていくフェーズ。基本的には以下の 3 つのフェーズを行っている

1. Discriminator の訓練

   ここでは、高画質の画像と生成器（G）によって低画質の画像から生成した画像（フェイク画像）を準備し、それらを識別器（D）に識別させて、訓練させている。

2. Generator の訓練

   ここでは、生成器（G）自身が作り出したフェイク画像をもとに、自ら学習させ、訓練させている。

3. 画像データなどの保存処理

   ここでは、Loss の状況を確認するためのログ出力や各種画像データの保存処理を行っています。

## 超解像 AI 作成機能(dataset.py)

学習する画像のデータをテンソル化するためのプログラムソース。低画質の画像はすべて 256×256 にリサイズされ、高画質の画像は全て 512×512 にリサイズするように設定しています。またランダムな回転・反転・クロップもここで定義している。

### 左右上下反転

用いる学習データのバリエーションを増やすために、transform = transforms.Compose([])でランダムに左右反転または上下反転させるように指示をしています。

### ランダム回転

用いる学習データのバリエーションを増やすために、transform = transforms.Compose([])でランダムに 0 度、90 度、180 度、270 度回転させるように指示をしています。

### ランダムクリップ

用いる学習データのバリエーションを増やすために、画像からランダムに一部を切り取る機能。

## 超解像 AI 作成機能(model.py)

生成器（G）と識別器（D）を定義しているプログラムソース。生成器（G）では残差ブロックを用いた畳み込み層と残差接続を実装しています。画像の 3 チャンネル（RGB）から 9×9 のフィルターを用いて 64 個の特徴マップを生成し、残差ブロックを 16 回行っている。また学習する画像のサイズに合わせるため、最終的にサイズを 2 倍にしている。識別器（D）では、畳み込み層を通過させた後、特徴量を算出するものとして定義している。

## 画像生成機能（upscale.py）

任意の画像をアップスケールするためのサンプルコード。学習済みモデルを指定し、アップスケールしたい画像を設定すれば、その学習済みモデルでアップスケールできます。なお元となるアップスケールのアルゴリズムは model.py の生成器（G）と同じです。

# 使用する画像の条件

- 高解像度の画像は 256×256 以上のサイズを使用することが条件（256×256 のサイズでランダムクリップするため）
- 艇解像度の画像は 128×128 以上のサイズを使用することが条件（128×128 のサイズでランダムクリップするため）

# 事前準備

## python のインストール

Python 3.10.6 をインストールしてください。バージョンが 3.10.6 である理由は開発時に使用していたためです。

```
pyenv install 3.10.6
```

## 仮想環境の構築

次のプロンプトから仮想環境を構築し、必要なモジュールのインストールを行なってください。

venv の仮想環境を構築します。

```
python -m venv venv
```

構築した仮想環境を有効にします。macOS と windows ではプロンプトが異なります

```
source venv/bin/activate
```

```
venv\Scripts\activate
```

## 仮想環境へモジュールをインストールする

仮想環境上に必要なモジュールを設定します。

```
pip install -r requirements.txt
```

## 開発環境

- CPU:AMD Ryzen 5 4500 6-Core Processor 36.0GHz
- メモリ:32GB
- GPU:NVIDIA GeForce RTX-4060
- Windows11
- python 3.10.6

# 免責事項

- このアプリケーションは GitHub の公開機能を用いて公開されています。このアプリケーションを使用したことにより発生した被害や損害について、このアプリの開発者は一切関与致しません。
